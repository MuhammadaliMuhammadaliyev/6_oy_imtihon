{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Profil" %}{% endblock %}

{% block content %}
<div class="grid">

  <!-- PROFIL HEADER -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="h1">üë§ {% trans "Profil" %}: {{ user.username }}</div>
        <div class="muted">{% trans "Foydalanuvchi ma‚Äôlumotlari va umumiy balans" %}</div>
      </div>

      <a class="btn primary" href="{% url 'users:profile_edit' %}">
        ‚úèÔ∏è {% trans "Profilni tahrirlash" %}
      </a>
    </div>

    <div class="hr"></div>

    <div class="row" style="gap:16px; flex-wrap:wrap;">
      <div class="badge">
        <b>{% trans "Username" %}:</b> {{ user.username }}
      </div>

      <div class="badge">
        <b>{% trans "Ism" %}:</b>
        {% if user.first_name %}{{ user.first_name }}{% else %}-{% endif %}
      </div>

      <div class="badge">
        <b>{% trans "Familiya" %}:</b>
        {% if user.last_name %}{{ user.last_name }}{% else %}-{% endif %}
      </div>
    </div>
  </div>


  <!-- TOTALS (USD / UZS / TOTAL UZS) -->
  <div class="card">
    <div class="row" style="justify-content:flex-end; gap:14px; flex-wrap:wrap;">

      <!-- USD CARD -->
      <div class="card" style="padding:14px; min-width:320px;">
        <div class="row" style="justify-content:space-between;">
          <div class="h1" style="font-size:16px; margin:0;">USD</div>
          <span class="badge">{% trans "Dollar" %}</span>
        </div>
        <div class="hr"></div>

        <div class="row" style="justify-content:flex-end">
          <div class="kpi in" style="min-width:180px">
            <div class="label">{% trans "Umumiy kirim" %}</div>
            <div class="value">{{ totals.income_usd }}</div>
          </div>

          <div class="kpi ex" style="min-width:180px">
            <div class="label">{% trans "Umumiy chiqim" %}</div>
            <div class="value">{{ totals.expense_usd }}</div>
          </div>

          <div class="kpi bal" style="min-width:180px">
            <div class="label">{% trans "Balans" %}</div>
            <div class="value">{{ totals.balance_usd }}</div>
          </div>
        </div>
      </div>

      <!-- UZS CARD -->
      <div class="card" style="padding:14px; min-width:320px;">
        <div class="row" style="justify-content:space-between;">
          <div class="h1" style="font-size:16px; margin:0;">UZS</div>
          <span class="badge">{% trans "So'm" %}</span>
        </div>
        <div class="hr"></div>

        <div class="row" style="justify-content:flex-end">
          <div class="kpi in" style="min-width:180px">
            <div class="label">{% trans "Umumiy kirim" %}</div>
            <div class="value">{{ totals.income_uzs }}</div>
          </div>

          <div class="kpi ex" style="min-width:180px">
            <div class="label">{% trans "Umumiy chiqim" %}</div>
            <div class="value">{{ totals.expense_uzs }}</div>
          </div>

          <div class="kpi bal" style="min-width:180px">
            <div class="label">{% trans "Balans" %}</div>
            <div class="value">{{ totals.balance_uzs }}</div>
          </div>
        </div>
      </div>

      <!-- TOTAL (UZS) -->
      <div class="card" style="padding:14px; min-width:320px;">
        <div class="row" style="justify-content:space-between;">
          <div class="h1" style="font-size:16px; margin:0;">{% trans "Umumiy" %}</div>
          <span class="badge">{% trans "Umumiy (UZS)" %}</span>
        </div>
        <div class="hr"></div>

        <div class="kpi bal" style="min-width:220px">
          <div class="label">{% trans "Umumiy balans" %}</div>
          <div class="value">
            {{ totals.total_balance_uzs }}
            <span class="badge" style="margin-left:6px;">UZS</span>
          </div>
        </div>

        <div class="muted" style="margin-top:8px;">
          {% trans "USD balans kurs bo‚Äòyicha UZS ga qo‚Äòshildi" %}
          (1 USD = {{ totals.usd_rate }} UZS)
        </div>
      </div>

    </div>
  </div>


  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="h1">{% trans "Hisoblar" %}</div>
        <div class="muted">{% trans "Har bir hisob bo‚Äòyicha balans" %}</div>

      </div>
      <a class="btn" href="{% url 'finance:account_list' %}">
        {% trans "Hisoblar" %}
      </a>
    </div>

    <div class="hr"></div>

    <div class="table-wrap">
      <table>
        <tr>
          <th>{% trans "Turi" %}</th>
          <th>{% trans "Valyuta" %}</th>
          <th>{% trans "Balans" %}</th>
        </tr>

        {% for a in accounts %}
        <tr>
          <td>
            <span class="badge">{{ a.get_type_display }}</span>
          </td>

          <td>
            {% if a.currency %}
              <span class="badge">{{ a.get_currency_display }}</span>
            {% else %}
              -
            {% endif %}
          </td>

          <td>
            {{ a.calculated_balance }}
            <span class="badge" style="margin-left:6px;">
              {{ a.currency }}
            </span>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="muted">{% trans "Hisob yo‚Äòq" %}</td>
        </tr>
        {% endfor %}
      </table>
    </div>
  </div>

</div>
{% endblock %}
